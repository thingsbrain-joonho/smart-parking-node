<% layout('/base') %>

<!-- Vendor CSS -->
<link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.css" />
<link rel="stylesheet" href="/assets/vendor/font-awesome/css/font-awesome.css" />
<link rel="stylesheet" href="/assets/vendor/magnific-popup/magnific-popup.css" />
<link rel="stylesheet" href="/assets/vendor/bootstrap-datepicker/css/datepicker3.css" />

<!-- Specific Page Vendor CSS -->
<link rel="stylesheet" href="/assets/vendor/jquery-ui/css/ui-lightness/jquery-ui-1.10.4.custom.css" />
<link rel="stylesheet" href="/assets/vendor/select2/select2.css" />
<link rel="stylesheet" href="/assets/vendor/bootstrap-multiselect/bootstrap-multiselect.css" />
<link rel="stylesheet" href="/assets/vendor/bootstrap-tagsinput/bootstrap-tagsinput.css" />
<link rel="stylesheet" href="/assets/vendor/bootstrap-colorpicker/css/bootstrap-colorpicker.css" />
<link rel="stylesheet" href="/assets/vendor/bootstrap-timepicker/css/bootstrap-timepicker.css" />
<link rel="stylesheet" href="/assets/vendor/dropzone/css/basic.css" />
<link rel="stylesheet" href="/assets/vendor/dropzone/css/dropzone.css" />
<link rel="stylesheet" href="/assets/vendor/bootstrap-markdown/css/bootstrap-markdown.min.css" />
<link rel="stylesheet" href="/assets/vendor/summernote/summernote.css" />
<link rel="stylesheet" href="/assets/vendor/summernote/summernote-bs3.css" />
<link rel="stylesheet" href="/assets/vendor/codemirror/lib/codemirror.css" />
<link rel="stylesheet" href="/assets/vendor/codemirror/theme/monokai.css" />

<!-- Theme CSS -->
<link rel="stylesheet" href="/assets/stylesheets/theme.css" />

<!-- Skin CSS -->
<link rel="stylesheet" href="/assets/stylesheets/skins/default.css" />

<!-- Theme Custom CSS -->
<link rel="stylesheet" href="/assets/stylesheets/theme-custom.css">

<!-- Head Libs -->
<script src="/assets/vendor/modernizr/modernizr.js"></script>
<!-- <script src="http://code.jquery.com/jquery-latest.min.js"></script> -->

<style>
    /* style all input elements with a required attribute */
    input:required {
        box-shadow: 4px 4px 10px rgba(200, 0, 0, 0.5);
    }
</style>

<section role="main" class="content-body">
    <header class="page-header">
        <h2>주차장 추가</h2>

        <div class="right-wrapper pull-right">
            <ol class="breadcrumbs">
                <li>
                    <a href="/">
                        <i class="fa fa-home"></i>
                    </a>
                </li>
                <li><span>주차장 추가</span></li>
            </ol>

            <!-- <a class="sidebar-right-toggle" data-open="sidebar-right"><i class="fa fa-chevron-left"></i></a> -->
        </div>
    </header>

    <div class="row">
        <div class="col-lg-12">
            <section class="panel">
                <header class="panel-heading">
                    <div class="panel-actions">
                        <a href="#" class="fa fa-caret-down"></a>
                    </div>

                    <h2 class="panel-title">주차장 수정</h2>
                    <span id="error" style="color:red;"></span>
                </header>

                <div class="panel-body">
                    <form id="test" class="form-horizontal form-bordered">
                        <div class="form-group">
                            <label class="col-md-3 control-label" for="inputReadOnly">주차장 번호</label>
                            <div class="col-md-6">
                                <input type="text" value="자동 생성" class="form-control" readonly="readonly"
                                    name="number" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="inputReadOnly">주차장 이름</label>
                            <div class="col-md-6">
                                <input type="text" class="form-control" name="name" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="inputReadOnly">주차장 주소</label>
                            <div class="col-md-6">
                                <input type="text" class="form-control" placeholder="ex) 제주시 복지로3길 1-4"
                                    name="address" />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="inputReadOnly">위치값</label>
                            <div class="col-sm-6">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control" placeholder="위도 (ex. 33.489542)"
                                            name="x">
                                    </div>
                                    <div class="visible-xs mb-md"></div>
                                    <div class="col-sm-6">
                                        <input type="text" class="form-control" placeholder="경도 (ex. 126.523265)"
                                            name="y">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="inputReadOnly">주차칸 갯수</label>
                            <div class="col-md-6">
                                <input type="text" class="form-control" placeholder="ex) 28" name="parking-lot"
                                    numberOnly />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="inputReadOnly">cctv 갯수</label>
                            <div class="col-md-6">
                                <input type="text" class="form-control" placeholder="ex) 5" name="cctv" numberOnly />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="inputReadOnly">30분 기본요금</label>
                            <div class="col-md-6">
                                <input type="text" class="form-control" placeholder="ex) 1000" name="basic_charge"
                                    numberOnly />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="inputReadOnly">15분 초과요금</label>
                            <div class="col-md-6">
                                <input type="text" class="form-control" placeholder="ex) 500" name="additional_charge"
                                    numberOnly />
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label">주차장 종류</label>
                            <div class="col-md-6">
                                <label class="radio-inline">
                                    <input type="radio" value="공영" name="charge-type"> 공영
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="사설" name="charge-type"> 사설
                                </label>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                <label class="radio-inline">
                                    <input type="radio" value="노상" name="park-type"> 노상
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" value="노외" name="park-type"> 노외
                                </label>
                            </div>

                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label" for="workingday">운영요일</label>
                            <div class="col-md-6">
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="1" name="workingday"> 평일
                                </label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="2" name="workingday"> 토요일
                                </label>
                                <label class="checkbox-inline">
                                    <input type="checkbox" value="3" name="workingday"> 공휴일
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label">평일 운영시간</label>
                            <div class="col-sm-6">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                <i class="fa fa-clock-o"></i>
                                            </span>
                                            <input type="text" value="9:00 AM" data-plugin-timepicker
                                                class="form-control" name="normal-start">
                                        </div>
                                    </div>
                                    <div class="visible-xs mb-md"></div>
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                <i class="fa fa-clock-o"></i>
                                            </span>
                                            <input type="text" value="10:00 PM" data-plugin-timepicker
                                                class="form-control" name="normal-end">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label">토요일 운영시간</label>
                            <div class="col-sm-6">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                <i class="fa fa-clock-o"></i>
                                            </span>
                                            <input type="text" value="9:00 AM" data-plugin-timepicker
                                                class="form-control" name="saturday-start">
                                        </div>
                                    </div>
                                    <div class="visible-xs mb-md"></div>
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                <i class="fa fa-clock-o"></i>
                                            </span>
                                            <input type="text" value="10:00 PM" data-plugin-timepicker
                                                class="form-control" name="saturday-end">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-md-3 control-label">공휴일 운영시간</label>
                            <div class="col-sm-6">
                                <div class="row">
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                <i class="fa fa-clock-o"></i>
                                            </span>
                                            <input type="text" value="9:00 AM" data-plugin-timepicker
                                                class="form-control" name="holiday-start">
                                        </div>
                                    </div>
                                    <div class="visible-xs mb-md"></div>
                                    <div class="col-sm-6">
                                        <div class="input-group">
                                            <span class="input-group-addon">
                                                <i class="fa fa-clock-o"></i>
                                            </span>
                                            <input type="text" value="10:00 PM" data-plugin-timepicker
                                                class="form-control" name="holiday-end">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </form>

                    <footer class="panel-footer" style="text-align:right; margin-top:30px;">
                        <button id="submit" class="btn btn-primary">수정 </button>
                        <button id="delete" class="btn btn-danger">삭제</button>
                    </footer>
                    <!-- <button id="submit">submit</button> -->
                </div>
            </section>
        </div>
    </div>
</section>

<script>
    $('#submit').click(function () {
        if (checkRequireOption()) {
            var data = $('#test').serializeArray();
            console.log(data);
            // console.log(data);
            $.ajax({
                url: '/setting',
                dataType: 'json',
                type: 'POST',
                data: {
                    data: data
                },
                // contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                success: function (result) {
                    if (result) {
                        // console.log('success');
                    }
                },
                // error: function(XMLHttpRequest, textStatus, errorThrown){
                //   console.log(XMLHttpRequest.responseText);
                // }
            });
            Swal.fire({
                type: 'success',
                title: '수정되었습니다',
                showConfirmButton: false,
                timer: 1500
            })
            setTimeout(function () {
                $(location).attr("href", "http://definetestserver.iptime.org:8083");
            }, 1000);
        }
    });

    $("input:text[numberOnly]").on("keyup", function () {
        $(this).val($(this).val().replace(/[^0-9]/g, ""));
    });

    // 필수항목 체크 및 초기화 함수
    function checkRequireOption() {
        $('#error').text('');
        var isValid = true;
        if (document.getElementsByName('name')[0].value == "") {
            $("input[name=name]").attr("required", true);
            isValid = false;
        } else if(document.getElementsByName('name')[0].value.length > 50){
            $("input[name=name]").attr("required", true);
            $('#error').text('주차장 이름은 50자를 넘을 수 없습니다.');
            isValid = false;
        }
        else {
            $("input[name=name]").attr("required", false);
        }
        if (document.getElementsByName('address')[0].value == "") {
            $("input[name=address]").attr("required", true);
            isValid = false;
        } else if(document.getElementsByName('address')[0].value.length > 50){
            $("input[name=address]").attr("required", true);
            $('#error').text('주차장 주소는 50자를 넘을 수 없습니다.');
            isValid = false;
        }
        else {
            $("input[name=address]").attr("required", false);
        }
        if (document.getElementsByName('x')[0].value == "") {
            $("input[name=x]").attr("required", true);
            isValid = false;
        } else {
            $("input[name=x]").attr("required", false);
        }
        if (document.getElementsByName('y')[0].value == "") {
            $("input[name=y]").attr("required", true);
            isValid = false;
        } else {
            $("input[name=y]").attr("required", false);
        }
        if (document.getElementsByName('parking-lot')[0].value == "") {
            $("input[name=parking-lot]").attr("required", true);
            isValid = false;
        } else {
            $("input[name=parking-lot]").attr("required", false);
        }
        if (document.getElementsByName('cctv')[0].value == "") {
            $("input[name=cctv]").attr("required", true);
            isValid = false;
        } else {
            $("input[name=cctv]").attr("required", false);
        }
        if (document.getElementsByName('basic_charge')[0].value == "") {
            $("input[name=basic_charge]").attr("required", true);
            isValid = false;
        } else {
            $("input[name=basic_charge]").attr("required", false);
        }
        if (document.getElementsByName('additional_charge')[0].value == "") {
            $("input[name=additional_charge]").attr("required", true);
            isValid = false;
        } else {
            $("input[name=additional_charge]").attr("required", false);
        }
        if (!$("input[name=charge-type]").is(':checked')) {
            $("input[name=charge-type]").attr("required", true);
            isValid = false;
        } else {
            $("input[name=charge-type]").attr("required", false);
        }
        if (!$("input[name=park-type]").is(':checked')) {
            $("input[name=park-type]").attr("required", true);
            isValid = false;
        } else {
            $("input[name=park-type]").attr("required", false);
        }
        if (isValid) return true;
        else return false;
    }

    $('#delete').click(function () {
        var data = $("input[name=number]").val();
        // console.log(id);
        Swal.fire({
            title: '정말 삭제하시겠습니까?',
            // text: "You won't be able to revert this!",
            type: 'warning',
            width: '450px',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: '확인',
            cancelButtonText: '취소',
        }).then((result) => {
            if (result.value) {
                $.ajax({
                    url: '/delete',
                    dataType: 'json',
                    type: 'POST',
                    data: {
                        data: data
                    },
                    contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
                    success: function (result) {
                        if (result) {
                            console.log('success');
                        }
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                        console.log(XMLHttpRequest.responseText);
                    }
                });
                Swal.fire({
                    // position: 'top-end',
                    type: 'success',
                    title: '삭제되었습니다',
                    showConfirmButton: false,
                    timer: 1500
                })
                setTimeout(function () {
                    $(location).attr("href", "http://definetestserver.iptime.org:8083");
                }, 1000);
            }
        })

    });
</script>

<!-- 수정항목에 기존값 띄워주는 코드 -->
<script>
    var info = <%-JSON.stringify(result) %>
        // console.log(info[0]);
    $("input[name=number]").attr("value", info[0].id);
    $("input[name=name]").attr("value", info[0].name);
    $("input[name=address]").attr("value", info[0].address);
    $("input[name=x]").attr("value", info[0].map_y);
    $("input[name=y]").attr("value", info[0].map_x);
    $("input[name=parking-lot]").attr("value", info[0].lot);
    $("input[name=cctv]").attr("value", info[0].cctv);
    $("input[name=basic_charge]").attr("value", info[0].basic_charge);
    $("input[name=additional_charge]").attr("value", info[0].additional_charge);
    if (info[0].divide == "공영") {
        $("input[name=charge-type][value=공영]").attr('checked', 'checked');
    } else {
        $("input[name=charge-type][value=사설]").attr('checked', 'checked');
    }
    if (info[0].type == "노상") {
        $("input[name=park-type][value=노상]").attr('checked', 'checked');
    } else {
        $("input[name=park-type][value=노외]").attr('checked', 'checked');
    }
    if(info[0].available.match('평일')){
        $("input[name=workingday][value=1]").attr('checked', 'checked');
    }
    if(info[0].available.match('토요일')){
        $("input[name=workingday][value=2]").attr('checked', 'checked');
    }
    if(info[0].available.match('공휴일')){
        $("input[name=workingday][value=3]").attr('checked', 'checked');
    }
    if(info[0].normal_start == ""){
        info[0].normal_start = "09:00 AM";
    }
    if(info[0].normal_end == ""){
        info[0].normal_end = "10:00 PM";
    }
    if(info[0].saturday_start == ""){
        info[0].saturday_start = "09:00 AM";
    }
    if(info[0].saturday_end == ""){
        info[0].saturday_end = "10:00 PM";
    }
    if(info[0].holiday_start == ""){
        info[0].holiday_start = "09:00 AM";
    }
    if(info[0].holiday_end == ""){
        info[0].holiday_end = "10:00 PM";
    }
    $("input[name=normal-start]").attr("value", info[0].normal_start);
    $("input[name=normal-end]").attr("value", info[0].normal_end);
    $("input[name=saturday-start]").attr("value", info[0].saturday_start);
    $("input[name=saturday-end]").attr("value", info[0].saturday_end);
    $("input[name=holiday-start]").attr("value", info[0].holiday_start);
    $("input[name=holiday-end]").attr("value", info[0].holiday_end);
</script>

<!-- Vendor -->
<script src="/assets/vendor/jquery/jquery.js"></script>
<script src="/assets/vendor/jquery-browser-mobile/jquery.browser.mobile.js"></script>
<script src="/assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="/assets/vendor/nanoscroller/nanoscroller.js"></script>
<script src="/assets/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
<script src="/assets/vendor/magnific-popup/magnific-popup.js"></script>
<script src="/assets/vendor/jquery-placeholder/jquery.placeholder.js"></script>

<!-- Specific Page Vendor -->
<script src="/assets/vendor/jquery-ui/js/jquery-ui-1.10.4.custom.js"></script>
<script src="/assets/vendor/jquery-ui-touch-punch/jquery.ui.touch-punch.js"></script>
<script src="/assets/vendor/select2/select2.js"></script>
<script src="/assets/vendor/bootstrap-multiselect/bootstrap-multiselect.js"></script>
<script src="/assets/vendor/jquery-maskedinput/jquery.maskedinput.js"></script>
<script src="/assets/vendor/bootstrap-tagsinput/bootstrap-tagsinput.js"></script>
<script src="/assets/vendor/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
<script src="/assets/vendor/bootstrap-timepicker/js/bootstrap-timepicker.js"></script>
<script src="/assets/vendor/fuelux/js/spinner.js"></script>
<script src="/assets/vendor/dropzone/dropzone.js"></script>
<script src="/assets/vendor/bootstrap-markdown/js/markdown.js"></script>
<script src="/assets/vendor/bootstrap-markdown/js/to-markdown.js"></script>
<script src="/assets/vendor/bootstrap-markdown/js/bootstrap-markdown.js"></script>
<script src="/assets/vendor/codemirror/lib/codemirror.js"></script>
<script src="/assets/vendor/codemirror/addon/selection/active-line.js"></script>
<script src="/assets/vendor/codemirror/addon/edit/matchbrackets.js"></script>
<script src="/assets/vendor/codemirror/mode/javascript/javascript.js"></script>
<script src="/assets/vendor/codemirror/mode/xml/xml.js"></script>
<script src="/assets/vendor/codemirror/mode/htmlmixed/htmlmixed.js"></script>
<script src="/assets/vendor/codemirror/mode/css/css.js"></script>
<script src="/assets/vendor/summernote/summernote.js"></script>
<script src="/assets/vendor/bootstrap-maxlength/bootstrap-maxlength.js"></script>
<script src="/assets/vendor/ios7-switch/ios7-switch.js"></script>

<!-- Theme Base, Components and Settings -->
<script src="/assets/javascripts/theme.js"></script>

<!-- Theme Custom -->
<script src="/assets/javascripts/theme.custom.js"></script>

<!-- Theme Initialization Files -->
<script src="/assets/javascripts/theme.init.js"></script>

<!-- Examples -->
<script src="/assets/javascripts/forms/examples.advanced.form.js" />
